function createNewWindow(t){var e=Ti.UI.createWindow({title:t.title,top:0}),a=Ti.UI.createImageView({top:0,width:"100%",height:"500",image:"images/bp.png"});return e.add(a),e}var win=Titanium.UI.currentWindow,Geolocation=require("geolocation"),Map=require("ti.map"),geolocation=require("geolocation"),tableView=Titanium.UI.createTableView({top:350}),bandInfo={},loadBands=function(){console.log(loadBands);var t=[],e=Titanium.Network.createHTTPClient();e.open("GET","http://api.bandsintown.com/artists/Family%20Force%205/events/recommended?location=Wise,VA&radius=150&app_id=CHRIS_COLLINS&api_version=2.0&format=json"),e.onload=function(){for(var e=JSON.parse(this.responseText),a=0;a<e.length;a++){var i=e[a].formatted_datetime,o=(e[a].datetime,e[a].artists[0].facebook_tour_dates_url,e[a].artists[0].thumb_url),n=(e[a].artists[0].image_url,e[a].venue.city,e[a].venue.region,e[a].venue.name,e[a].title),r=(e[a].artists[0].name,e[a].formatted_location,e[a].venue.latitude,e[a].venue.longitude,e[a].ticket_type,e[a].ticket_status,e[a].ticket_url,Titanium.UI.createTableViewRow({height:"90",backgroundColor:"#000",backgroundImage:"images/blackbar_04.png",hasChild:"yes",content:e[a]})),d=Titanium.UI.createView({height:"auto",layout:"vertical",top:5,right:5,bottom:5,left:5}),c=Titanium.UI.createImageView({image:o,top:5,left:5,height:70,width:70,borderRadius:10});d.add(c);var l=Titanium.UI.createLabel({text:i,color:"#fff",left:85,width:"auto",top:-55,bottom:2,height:"auto",textAlign:"left",font:{fontFamily:"Helvetica",fontSize:14,fontWeight:"thin"}});d.add(l);var n=Titanium.UI.createLabel({text:n,color:"red",left:85,right:5,top:5,bottom:2,height:"auto",width:"auto",textAlign:"left",font:{fontFamily:"Helvetica",fontSize:14,fontWeight:"bold"}});d.add(n),r.add(d),r.className="item"+a,t.push(r)}tableView.data=t,tableView.backgroundImage="images/background.jpg",tableView.separatorColor="red",win.add(tableView)},e.send()};loadBands(),tableView.addEventListener("click",function(t){function e(){var e=Map.createAnnotation({latitude:t.row.content.venue.latitude,longitude:t.row.content.venue.longitude,title:t.row.content.artists[0].name,subtitle:t.row.content.venue.name,image:"images/guitar",animate:!0,customProperty:"Concert"}),a=Map.createView({mapType:Map.HYBRID,animate:!0,region:{latitude:t.row.content.venue.latitude,longitude:t.row.content.venue.longitude,latitudeDelta:.05,longitudeDelta:.05},regionFit:!1,height:300,width:400,bottom:300,userLocation:!0,annotations:[e]});return a.selectAnnotation(e),i.add(a),a}console.log(JSON.stringify(t.row));var a=createNewWindow({title:"tour_band",color:"#fff",url:"bandWin.js",backgroundImage:"images/concert.jpg",tabBarHidden:!1,statusBarHidden:!1}),i=Ti.UI.createScrollView({height:"100%",backgroundColor:"black",right:0,left:0});a.add(i);var o=Ti.UI.createImageView({borderRadius:10,image:t.row.content.artists[0].image_url,width:"165",height:"165",top:50});i.add(o);var n=Ti.UI.createView({backgroundImage:"images/background.jpg",bottom:0,left:0,width:"100%",borderRadius:10,height:"450"});i.add(n);var r=Ti.UI.createLabel({text:t.row.content.artists[0].name,color:"#fff",font:{fontFamily:"Helvetica",fontSize:28,fontWeight:"bold"},height:"auto",width:"auto",top:o.top+170,textAlign:"center"});i.add(r);var d=Ti.UI.createLabel({text:t.row.content.formatted_datetime,color:"#fff",font:{fontFamily:"Helvetica",fontSize:16,fontWeight:"thin"},height:"auto",width:"175",top:r.top+35,textAlign:"center"});i.add(d);var c=Ti.UI.createLabel({text:t.row.content.formatted_location,color:"#fff",font:{fontFamily:"Helvetica",fontSize:20,fontWeight:"bold"},height:"auto",width:"auto",top:d.top+45,textAlign:"center"});i.add(c);var l=Ti.UI.createLabel({text:t.row.content.ticket_type+" are "+t.row.content.ticket_status,color:"#fff",font:{fontFamily:"Helvetica",fontSize:20,fontWeight:"bold"},height:"auto",width:"auto",top:c.top+55,textAlign:"center"});i.add(l);var u=Ti.UI.createButton({title:"Back",color:"#fff",backgroundImage:"images/redbtn.png",height:30,width:80,top:20,left:15});i.add(u),a.open();var g=Ti.UI.createButton({title:"Buy Tickets",color:"red",font:{fontFamily:"Helvetica",fontSize:20,fontWeight:"bold"},height:20,width:200,top:l.top+30});g.addEventListener("click",function(){alert("You will now be redirected to the ticket site.");var e=Ti.UI.createWebView({url:t.row.content.ticket_url,height:"auto",width:"auto"});e.addEventListener("load",function(t){Ti.API.info("webview loaded: "+t.url)}),i.add(e);var a=Ti.UI.createButton({title:"Back",color:"#fff",backgroundImage:"images/redbtn.png",height:30,width:80,top:20,left:15});a.addEventListener("click",function(){e.hide()}),e.add(a)}),i.add(g);var f=Ti.UI.createButton({title:"Camera",backgroundImage:"images/cambtn.png",color:"#fff",bottom:50,width:140,height:140});i.add(f);var h=Ti.UI.createView({top:"20%",width:"90%",height:"",backgroundColor:"#FFCC00"});i.add(h);var s,m={onSuccess:function(t){t.mediaType===Ti.Media.MEDIA_TYPE_PHOTO?(s&&h.remove(s),s=Ti.UI.createImageView({image:t.media,zIndex:1}),h.add(s)):t.mediaType===Ti.Media.MEDIA_TYPE_VIDEO?(vid=Ti.Media.createVideoPlayer({media:t.media}),h.add(vid)):alert("This is not a photo or video")},onCancel:function(){alert("Photo cancelled")},onError:function(t){alert("An error occured with code: "+t.code)}};f.addEventListener("click",function(){Ti.Media.showCamera({success:m.onSuccess,cancel:m.onCancel,error:m.onError,allowEditing:!0,mediaTypes:[Ti.Media.MEDIA_TYPE_PHOTO,Titanium.Media.MEDIA_TYPE_VIDEO],videoQuality:Ti.Media.QUALITY_HIGH,saveToPhotoGallery:!0})});var b=Titanium.UI.createButton({title:"Photos",color:"#fff",backgroundImage:"images/redbtn.png",height:30,width:80,top:20,right:15,zIndex:2});i.add(b),b.addEventListener("click",function(){Titanium.Media.openPhotoGallery({success:function(){alert("Your image was saved.")},error:function(){alert("There was an error")},cancel:function(){alert("The photo gallery was cancelled")},allowEditing:!0,saveToPhotoGallery:!0,mediaTypes:[Ti.Media.MEDIA_TYPE_PHOTO,Titanium.Media.MEDIA_TYPE_VIDEO]})}),u.addEventListener("click",function(){a.close()}),e()});